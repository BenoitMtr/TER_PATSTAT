{"version":3,"sources":["assets/js/index.js"],"names":["ol","View","Overlay","layer","TileLayer","Tile","VectorLayer","Vector","style","Fill","Style","Stroke","CircleStyle","Circle","Text","source","OSM","VectorSource","format","KML","GeoJSON","fromLonLat","proj","geom","LineString","MultiLineString","Point","Feature","nutsStack","brevetVisibles","map","$","e","document","querySelectorAll","window","onload","_","forEach","elt","onclick","backBtn","CustomMap","listNuts","fetchGeoJSON","updateTbody","nuts","tbody","innerHTML","total","reduce","n","tr","createElement","code","label","nb_subnut","brevetsCache","length","children","level","displayListBrevets","has_gps","showKML","server_url","addVec","hideKML","onmouseenter","highlight","onmouseleave","unhighlight","alert","backgroundColor","append","visibility","pop","name","onRemoveCallback","htmlSafeName","replace","id","remove","liste","console","log","appln_id","person_name","appln_title","appln_filing_date"],"mappings":"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","file":"js.5c615dc2.js","sourceRoot":"..","sourcesContent":["// Shortcut of the dependencies\r\nconst { View, Overlay } = ol;\r\nconst { Tile: TileLayer, Vector: VectorLayer } = ol.layer;\r\nconst { Fill, Style, Stroke, Circle: CircleStyle, Text } = ol.style;\r\nconst { OSM, Vector: VectorSource } = ol.source;\r\nconst { KML, GeoJSON } = ol.format;\r\nconst { fromLonLat } = ol.proj;\r\nconst { LineString, MultiLineString, Point } = ol.geom;\r\nconst { Feature } = ol;\r\n\r\nconst nutsStack = [];\r\n\r\nlet brevetVisibles = false;\r\n\r\nlet map;\r\n\r\nconst $ = e => document.querySelectorAll(e);\r\n\r\nwindow.onload = _ => {\r\n    $('table#listNuts tfoot tr td button, table#listBrevets tfoot tr td button').forEach(elt => elt.onclick = _ => backBtn());\r\n    map = new CustomMap($('div#map')[0]);\r\n    listNuts();\r\n\r\n    fetchGeoJSON();\r\n};\r\n\r\nfunction updateTbody(nuts) {\r\n    const tbody = $('table#listNuts tbody')[0];\r\n    tbody.innerHTML = \"\";\r\n    const total = nuts.reduce((total, n) => {\r\n        const tr = document.createElement('tr');\r\n        tr.innerHTML = `<td>${n.code}</td>\r\n                        <td>${n.label}</td>\r\n                        <td>${n.nb_subnut}</td>\r\n                        <td><button>Add</button></td>\r\n                        <td><button>F</button></td>\r\n\t\t\t\t\t\t<td><label>${brevetsCache[n.code].length}</label></td>\r\n\t\t\t\t        <td><button>Liste de brevets</button></td>`;\r\n        tr.children[4].children[0].onclick = _ => listNuts(n.code, n.level + 1);\r\n        tr.children[6].children[0].onclick = _ => displayListBrevets(brevetsCache[n.code]);\r\n        if (n.has_gps) {\r\n            tr.children[3].children[0].onclick = _ => {\r\n                map.showKML(`${server_url}/api/getGeometry/${n.code}`, n.code);\r\n                addVec(n.code, _ => map.hideKML(n.code));\r\n            };\r\n            tr.onmouseenter = _ => map.highlight(n.code, brevetsCache[n.code].length);\r\n            tr.onmouseleave = _ => map.unhighlight(n.code);\r\n        } else {\r\n            tr.children[3].children[0].onclick = _ => alert(\"No gps for this NUTS\");\r\n            tr.style.backgroundColor = '#FF000033';\r\n        }\r\n        tbody.append(tr);\r\n        return total + n.nb_subnut;\r\n    }, 0);\r\n    $('td#totalNuts')[0].innerHTML = nuts.length;\r\n    $('td#totalSubNuts')[0].innerHTML = total;\r\n}\r\n\r\nfunction backBtn() {\r\n    if (brevetVisibles) {\r\n        brevetVisibles = false;\r\n        $('table#listNuts')[0].style.visibility = 'visible';\r\n        $('table#listBrevets')[0].style.visibility = 'hidden';\r\n        return;\r\n    }\r\n\r\n    if (nutsStack.length == 1) {\r\n        alert('Déja à la racine !');\r\n        return;\r\n    }\r\n    nutsStack.pop();\r\n    updateTbody(nutsStack[nutsStack.length - 1]);\r\n}\r\n\r\nfunction addVec(name, onRemoveCallback) {\r\n    const tr = document.createElement('tr');\r\n    const htmlSafeName = name.replace(' ', '-'); // WARN: It's not the best way safety wise\r\n    tr.id = `layer${htmlSafeName}`;\r\n    tr.innerHTML = `<td>${name}</td><td><button>X</button></td>`;\r\n    tr.children[1].children[0].onclick = _ => {\r\n        onRemoveCallback();\r\n        $('table#listOverlay tbody tr#layer' + htmlSafeName)[0].remove();\r\n    };\r\n    $('table#listOverlay tbody')[0].append(tr);\r\n}\r\n\r\nfunction displayListBrevets(liste) {\r\n    console.log(\"liste: \" + liste);\r\n    brevetVisibles = true;\r\n    $('table#listNuts')[0].style.visibility = 'hidden';\r\n    $('table#listBrevets')[0].style.visibility = 'visible';\r\n    const tbody = $('table#listBrevets tbody')[0];\r\n    tbody.innerHTML = \"\";\r\n    liste.forEach(n => {\r\n        const tr = document.createElement('tr');\r\n        tr.innerHTML = `<td>${n.appln_id}</td>\r\n                            <td>${n.person_name}</td>\r\n                            <td>${n.appln_title}</td>\r\n                            <td>${n.appln_filing_date}</td>`;\r\n        tbody.append(tr);\r\n    });\r\n}"]}