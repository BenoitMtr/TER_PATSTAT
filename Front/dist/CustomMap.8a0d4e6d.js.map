{"version":3,"sources":["assets/js/CustomMap.js"],"names":["CustomMap","elt","target","layers","TileLayer","source","OSM","view","View","center","fromLonLat","zoom","vecCache","kmlCache","formatCode","highlight","name","KML","removeLayer","console","warn","addLayer","nb_bevret","vecName","feat_high","feature_cache","LB","getFeatureById","getGeometry","getCoordinates","geom_arr","MultiLineString","getFeatures","reduce","arr","feat","i","push","LineString","styles","getLineStrings","map","ls","Style","stroke","Stroke","color","width","VectorLayer","VectorSource","features","Feature","style","addVec","RG","fill","Fill","image","CircleStyle","radius","text","Text","font","toString","removeVec","url","format","extractStyles","feature","geometry","get","ol","Map"],"mappings":"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","file":"CustomMap.8a0d4e6d.js","sourceRoot":"..","sourcesContent":["class CustomMap extends ol.Map {\r\n    constructor(elt) {\r\n        super({\r\n            target: elt,\r\n            layers: [\r\n                new TileLayer({\r\n                    source: new OSM()\r\n                })\r\n            ],\r\n            view: new View({\r\n                center: fromLonLat([24.596220, 53.700813]), //center of europe\r\n                zoom: 4.5\r\n            })\r\n        });\r\n\r\n        this.vecCache = {};\r\n        this.kmlCache = {};\r\n\r\n        this.formatCode = {\r\n            highlight: name => \"Highlight \" + name,\r\n            KML: name => \"KML \" + name\r\n        };\r\n    }\r\n\r\n    removeVec(name) {\r\n        this.removeLayer(this.vecCache[name]);\r\n    }\r\n\r\n    addVec(name) {\r\n        if (!this.vecCache[name]) {\r\n            console.warn('No vector saved named', name);\r\n            return;\r\n        }\r\n        this.addLayer(this.vecCache[name]);\r\n    }\r\n\r\n    highlight(name, nb_bevret) {\r\n        const vecName = this.formatCode.highlight(name);\r\n        if (!this.vecCache[vecName + \"LB\"]) {\r\n            const feat_high = feature_cache.LB.getFeatureById(name).getGeometry().getCoordinates();\r\n\r\n            const geom_arr = new MultiLineString(feature_cache.LB.getFeatures().reduce((arr, feat, i) => {\r\n                if (feat.name === name)\r\n                    return arr;\r\n                arr.push(new LineString([feat_high, feat.getGeometry().getCoordinates()]));\r\n                return arr;\r\n            }, []));\r\n\r\n            const styles = geom_arr.getLineStrings().map((ls) => {\r\n                return new Style({\r\n                    stroke: new Stroke({\r\n                        color: 'rgba(0, 0, 0, 0.8)',\r\n                        width: 1 // TODO Independant width for each linestring\r\n                    })\r\n                });\r\n            });\r\n\r\n            this.vecCache[vecName + \"LB\"] = new VectorLayer({\r\n                source: new VectorSource({\r\n                    features: [new Feature({\r\n                        'geometry': geom_arr\r\n                    })]\r\n                }),\r\n                style: styles\r\n            });\r\n        }\r\n        this.addVec(vecName + \"LB\");\r\n\r\n        if (!this.vecCache[vecName + \"RG\"]) {\r\n            this.vecCache[vecName + \"RG\"] = new VectorLayer({\r\n                source: new VectorSource({\r\n                    features: [new Feature({\r\n                        'geometry': feature_cache.RG.getFeatureById(name).getGeometry()\r\n                    })]\r\n                }),\r\n                style: new Style({\r\n                    fill: new Fill({\r\n                        color: 'rgba(255, 0, 0, 0.2)'\r\n                    })\r\n                })\r\n            });\r\n        }\r\n        this.addVec(vecName + \"RG\");\r\n\r\n        if (!this.vecCache[vecName + \"CO\"]) {\r\n            this.vecCache[vecName + \"CO\"] = new VectorLayer({\r\n                source: new VectorSource({\r\n                    features: [feature_cache.LB.getFeatureById(name)]\r\n                }),\r\n                style: new Style({\r\n                    image: new CircleStyle({\r\n                        radius: 10,\r\n                        fill: new Fill({\r\n                            color: 'rgba(0, 0, 255, 1)'\r\n                        })\r\n                    }),\r\n                    text: new Text({\r\n                        font: '12px Calibri,sans-serif',\r\n                        text: nb_bevret.toString(),\r\n                        fill: new Fill({\r\n                            color: 'rgba(255, 255, 255, 1)'\r\n                        }),\r\n                        stroke: new Stroke({\r\n                            color: 'rgba(255, 255, 255, 1)'\r\n                        })\r\n                    })\r\n                })\r\n            });\r\n        }\r\n        this.addVec(vecName + \"CO\");\r\n\r\n        return vecName;\r\n    }\r\n\r\n    unhighlight(name) {\r\n        this.removeVec(this.formatCode.highlight(name) + \"LB\");\r\n        this.removeVec(this.formatCode.highlight(name) + \"RG\");\r\n        this.removeVec(this.formatCode.highlight(name) + \"CO\");\r\n    }\r\n\r\n    showKML(url, name) {\r\n        const vecName = this.formatCode.KML(name);\r\n        // If VectorLayer not in cache create new\r\n        if (!this.vecCache[vecName]) {\r\n            this.vecCache[vecName] = new VectorLayer({\r\n                source: new VectorSource({\r\n                    url: url,\r\n                    format: new KML({\r\n                        extractStyles: false\r\n                    })\r\n                }),\r\n                style: feature => new Style({\r\n                    fill: new Stroke({\r\n                        color: [255, 0, 0, 0.8]\r\n                    }),\r\n                    geometry: feature.get('geometry')\r\n                })\r\n            });\r\n        }\r\n        this.addVec(vecName);\r\n        return vecName;\r\n    }\r\n\r\n    hideKML(name) {\r\n        this.removeVec(this.formatCode.KML(name));\r\n    }\r\n}"]}